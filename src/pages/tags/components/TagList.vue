<script setup lang="ts">import ArrowIcon from "../../../assets/icons/ArrowIcon.vue";import SearchIcon from "../../../assets/icons/SearchIcon.vue";import TrashIcon from "../../../assets/icons/TrashIcon.vue";import {  editState,  isPanelVisible,  originTag,  reloadListTags,  showAddPanel,  tagItems} from "../composables/TagDataComposable.ts";import {useMessage} from "naive-ui";import {useLanguage} from "../../../services/LanguageService.ts";import {onMounted, onUnmounted, ref} from "vue";import ClipboardDBService from "../../../services/ClipboardDBService.ts";import {error} from "@tauri-apps/plugin-log";import {listen} from "@tauri-apps/api/event";import {animationEffect} from "../composables/AnimationComposable.ts";const message = useMessage();const {currentLanguage} = useLanguage();// 搜索关键词const searchText = ref('')/** * 加载标签列表 */async function loadTags() {  try {    const db = await ClipboardDBService.getInstance();    const tags = await db.getAllTags();    if (tags) {      tagItems.value = tags    }  } catch (e) {    console.error('加载标签失败', e)    error("标签页面加载失败：" + e);    message.error(currentLanguage.value.pages.tags.loadFailedMsg)  }}/** * 删除标签 * @param id 标签id * @param index 标签索引 */async function deleteTag(id: number, index: number) {  try {    console.log(tagItems.value, id, index)    const db = await ClipboardDBService.getInstance();    await db.deleteTag(id);    message.success(currentLanguage.value.pages.tags.deleteSuccessMsg)    if (editState.tagId === id) {      editState.tagId = null      isPanelVisible.value = false    }    tagItems.value.splice(index, 1);    console.log(tagItems.value)    // 刷新剪贴板的标签列表    await reloadListTags();  } catch (error) {    console.error('删除标签失败', error)    message.error(currentLanguage.value.pages.tags.deleteFailedMsg)  }}/** * 过滤标签 */function filterTags() {  if (!searchText.value) {    loadTags()    return  }  const keyword = searchText.value.toLowerCase()  tagItems.value = tagItems.value.filter(tag =>      tag.name.toLowerCase().includes(keyword)  )}/** * 选择标签 * @param tag * @param index */function selectTag(tag: TagItem, index: number) {  editState.tagId = tag.id  editState.index = index  editState.isEdit = true  editState.currentTagId = tag.id  editState.tagName = tag.name  editState.tagColor = tag.color  originTag.value = {...tag};  isPanelVisible.value = true}/** * 监听标签绑定的数据变化 */let updateBindQuantityListener: any = null;function initUpdateBindQuantityListener() {  return listen('update-bind-quantity', () => {    loadTags();  })}// 组件挂载时加载标签列表onMounted(() => {  loadTags()  updateBindQuantityListener = initUpdateBindQuantityListener();})onUnmounted(() => {  if (updateBindQuantityListener) {    updateBindQuantityListener();  }});</script><template>  <!-- 左侧标签列表 -->  <div class="tag-list-panel" :class="{ 'tag-list-panel-narrow': isPanelVisible }">    <!-- 搜索框 -->    <div class="tag-list-header">      <n-input v-model:value="searchText" :placeholder="currentLanguage.pages.list.searchHint"               clearable @input="filterTags">        <template #prefix>          <!-- 搜索 -->          <n-icon size="18">            <SearchIcon/>          </n-icon>        </template>      </n-input>    </div>    <!-- 标签列表 -->    <div class="tag-list-container">      <n-empty v-if="tagItems.length === 0"/>      <div v-else class="tag-list">        <transition-group name="tag-list" :css="animationEffect.enabled">          <div v-for="(tag, index) in tagItems" :key="tag.id" class="tag-item"               :class="{ 'tag-item-active': editState.tagId === tag.id }" @click="selectTag(tag, index)"               :style="{ borderLeft: `4px solid ${tag.color}` }">            <div class="tag-item-content">              <div class="tag-color-preview" :style="{ backgroundColor: tag.color }"></div>              <div class="tag-item-name">{{ tag.name }}</div>              <div v-if="tag.stats && tag.stats > 0" class="tag-item-stats">{{                  currentLanguage.pages.tags.bindDataHint                }}{{ tag.stats }}              </div>            </div>            <div class="tag-item-actions" @click.stop>              <div class="tag-delete-button" @click="deleteTag(tag.id, index)">                <TrashIcon/>              </div>            </div>          </div>        </transition-group>      </div>    </div>    <!-- 切换按钮 -->    <div class="toggle-panel-button" @click="showAddPanel">      <div class="toggle-icon-container" :class="{ 'unfold': isPanelVisible }">        <ArrowIcon/>      </div>    </div>  </div></template><style scoped>/* 左侧标签列表面板 */.tag-list-panel {  width: 100%;  height: 100%;  border-right: 1px solid var(--theme-border);  display: flex;  flex-direction: column;  position: relative;  transition: width var(--animation-duration, 0.3s) ease;  /* 改为transform过渡效果 */  z-index: 2;  /* 确保在右侧面板上层 */}/* 当右侧面板可见时，调整左侧面板位置 */.tag-list-panel-narrow {  width: calc(100% - 350px) !important;  /* 减小宽度，为右侧面板留出空间 */  transition: width var(--animation-duration, 0.3s) ease;  /* 添加宽度过渡效果 */}.tag-list-header {  padding: 16px 16px 8px;  height: 35px;  border-bottom: 1px solid var(--theme-border);}.tag-list-header :deep(.n-input) {  border-radius: 4px;  border: 1px solid var(--theme-border);  background-color: var(--theme-background);}.tag-list-header :deep(.n-input__input) {  color: var(--theme-textHint);}.tag-list-container {  flex: 1;  overflow-y: auto;  padding: 8px 0;}.tag-list {  display: flex;  flex-direction: column;  gap: 8px;  padding: 0 8px;}.tag-item {  display: flex;  justify-content: space-between;  align-items: center;  padding: 12px 16px;  background-color: var(--theme-cardBackground);  border-radius: 4px;  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);  transition: all var(--animation-duration, 0.3s) ease;  cursor: pointer;}.tag-item:hover {  background-color: var(--theme-hoverBackground) !important;}/*内容列表动画效果start*//* 进入动画 - 从右侧进入 */.tag-list-enter-from {  opacity: 0;  transform: translateX(100%);}.tag-list-enter-to {  opacity: 1;  transform: translateX(0);}/* 离开动画 - 向左侧离开 */.tag-list-leave-from {  opacity: 1;  transform: translateX(0);}.tag-list-leave-to {  opacity: 0;  transform: translateX(-100%);}/* 离开中 */.tag-list-leave-active {  position: relative;}/*内容列表动画效果end*/.tag-item-active {  background-color: var(--theme-border) !important;  border-left-width: 6px !important;}.tag-item-content {  display: flex;  align-items: center;  gap: 12px;  width: 100%;}.tag-color-preview {  width: 24px;  height: 24px;  border-radius: 4px;  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);  flex-shrink: 0;}.tag-item-name {  font-size: 14px;  font-weight: 500;  flex: 1;  white-space: nowrap;  overflow: hidden;  text-overflow: ellipsis;}.tag-item-stats {  font-size: 12px;  margin-right: 10px;  color: var(--theme-textHint);}.tag-item-actions {  display: flex;  align-items: center;}.tag-delete-button {  width: 20px;  height: 20px;  display: flex;  align-items: center;  justify-content: center;  cursor: pointer;  opacity: 0.7;  transition: all var(--animation-duration, 0.3s);}.tag-delete-button:hover {  opacity: 1;  transform: scale(1.1);}/* 切换按钮样式 */.toggle-panel-button {  position: absolute;  top: 93%;  right: 0;  transform: translateY(-50%);  width: 25px;  height: 30px;  background-color: var(--theme-togglePanelBtnBackgroundColor);  border-radius: 15px 0 0 15px;  display: flex;  align-items: center;  justify-content: center;  box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);  cursor: pointer;  transition: all var(--animation-duration, 0.3s);  z-index: 3;  opacity: 0.6;}.toggle-panel-button:hover {  opacity: 1;}.toggle-icon-container {  width: 16px;  height: 16px;  display: flex;  align-items: center;  justify-content: center;  color: white;  transition: transform var(--animation-duration, 0.3s) ease;  opacity: 0.5;}.toggle-icon-container:hover {  opacity: 1;}.unfold {  opacity: 1 !important;  transform: rotate(180deg);}</style>