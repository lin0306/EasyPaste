<script setup lang="ts">import {getContrastColor} from "../../../utils/ContrastColorUtil.ts";import {NTag, useMessage} from "naive-ui";import AddIcon from "../../../assets/icons/AddIcon.vue";import HintIcon from "../../../assets/icons/HintIcon.vue";import {  editState,  isPanelVisible,  originTag,  reloadListTags,  resetForm,  tagItems} from "../composables/TagDataComposable.ts";import {useLanguage} from "../../../services/LanguageService.ts";import ClipboardDBService from "../../../services/ClipboardDBService.ts";const message = useMessage();const {currentLanguage} = useLanguage();/** * 打开添加表单 */function openAddForm() {  if (editState.isEdit) {    tagItems.value[editState.index] = originTag.value;  }  resetForm()}/** * 取消编辑操作 */function cancelEdit() {  if (editState.isEdit) {    tagItems.value[editState.index] = originTag.value;  }  resetForm();  isPanelVisible.value = false}/** * 添加标签 */async function addTag() {  if (!editState.tagName.trim()) {    message.warning(currentLanguage.value.pages.tags.tageNameIsNullWarnMsg)    return;  }  try {    if (editState.isEdit && editState.currentTagId) {      // 更新标签      const db = await ClipboardDBService.getInstance();      await db.updateTag(editState.currentTagId, editState.tagName, editState.tagColor);      message.success(currentLanguage.value.pages.tags.editSuccessMsg)    } else {      // 添加新标签      const db = await ClipboardDBService.getInstance();      await db.addTag(editState.tagName, editState.tagColor);      message.success(currentLanguage.value.pages.tags.saveSuccessMsg)      // 插入新数据      setTimeout(async () => {        const tag = await db.getLatestTag();        if (tag) {          tagItems.value.push(tag[0]);        }      }, 50);    }    // 重置表单并刷新列表    resetForm();    isPanelVisible.value = false    // 刷新剪贴板的标签列表    await reloadListTags();  } catch (error) {    console.error('操作标签失败', error)    message.error(editState.isEdit ? currentLanguage.value.pages.tags.editFailedMsg : currentLanguage.value.pages.tags.saveFailedMsg)  }}</script><template>  <!-- 右侧详情/编辑面板 -->  <div class="tag-detail-panel" :class="{ 'panel-visible': isPanelVisible }">    <div class="panel-header">      <h3>{{          editState.isEdit ? currentLanguage.pages.tags.editTitle : currentLanguage.pages.tags.addTitle        }}</h3>      <div>        <AddIcon class="add-btn" v-if="editState.isEdit" @click="openAddForm"/>      </div>    </div>    <div class="panel-content">      <div class="tag-form">        <div class="form-item">          <label>{{ currentLanguage.pages.tags.tagName }}</label>          <n-input v-model:value="editState.tagName"                   :placeholder="currentLanguage.pages.tags.tagNamePlaceholder"                   clearable/>          <div class="hint">            <HintIcon class="hint-icon"/>            <span class="hint-text">                  {{ currentLanguage.pages.tags.tagNameHint }}                </span>          </div>        </div>        <div class="form-item">          <label>{{ currentLanguage.pages.tags.tagColor }}</label>          <div class="color-picker-container">            <n-color-picker v-model:value="editState.tagColor" :placement="'left-end'"/>          </div>        </div>        <div class="form-item">          <label>{{ currentLanguage.pages.tags.preview }}</label>          <div              class="preview-tag-item"              :style="{ backgroundColor: editState.tagColor }"          >                  <span class="preview-tag-name"                        :style="{ color: getContrastColor(editState.tagColor) }">{{ editState.tagName }}</span>          </div>          <n-tag              size="small"              round              closable              bordered              class="preview-item-tag"          >            <div class="preview-item-tag-content">              <div :style="{ backgroundColor: editState.tagColor }" class="preview-item-tag-color"></div>              <div class="preview-item-tag-name">                {{ editState.tagName }}              </div>            </div>          </n-tag>        </div>        <div class="form-actions">          <n-button @click="cancelEdit">            {{ currentLanguage.pages.tags.cancelBtn }}          </n-button>          <n-button type="primary" @click="addTag" :disabled="!editState.tagName.trim()">            {{ currentLanguage.pages.tags.saveBtn }}          </n-button>        </div>      </div>    </div>  </div></template><style scoped>/* 右侧详情/编辑面板 */.tag-detail-panel {  width: 350px;  /* 固定宽度 */  height: 100%;  background-color: var(--theme-card-background);  position: absolute;  right: -350px;  /* 初始位置在屏幕外 */  top: 0;  overflow: hidden;  box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);  z-index: 4;  /* 确保在左侧面板上层 */  transition: right var(--animation-duration, 0.3s) ease;  /* 添加过渡效果 */}.panel-visible {  right: 0;  /* 显示时移动到可见区域 */}.panel-header {  height: 35px;  display: flex;  justify-content: space-between;  align-items: center;  padding: 16px 16px 8px;  border-bottom: 1px solid var(--theme-border);}.panel-header h3 {  margin: 0;  font-size: 18px;  font-weight: 500;}.panel-content {  padding: 8px 16px;  height: calc(100% - 130px);  overflow-y: auto;}/* 表单样式 */.tag-form {  padding: 8px 0;}.form-item {  margin-bottom: 10px;}.form-item label {  display: block;  margin-bottom: 8px;  font-weight: 500;}.color-picker-container {  margin-top: 8px;}.form-actions {  display: flex;  justify-content: flex-end;  gap: 12px;  position: absolute;  bottom: 0;  right: 0;  padding: 10px;  background-color: var(--theme-background);  border-top: 1px solid var(--theme-border);  width: 330px;}.add-btn {  width: 20px;}.hint {  display: flex;  font-size: 11px;  opacity: 0.5;  align-items: center;  justify-content: flex-start;  flex-direction: row;  color: var(--theme-text);}.hint-icon {  width: 12px;  height: 12px;  margin-right: 4px;}.hint-text {  width: 98%;}.preview-tag-item {  width: 100px;  height: 30px;  border-radius: 4px;  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);  display: flex;  align-items: center;  justify-content: flex-start;}.preview-tag-name {  position: absolute;  margin-left: 20px;  font-size: 12px;  width: 70px;  overflow: hidden;  white-space: nowrap;  text-overflow: ellipsis;  word-break: break-all;}.preview-item-tag {  margin-top: 10px;  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);}.preview-item-tag-content {  display: flex;  flex-direction: row;  align-items: center;  justify-content: center;  gap: 3px;}.preview-item-tag-color {  width: 12px;  height: 12px;  border-radius: 10px;  box-shadow: 0 0 3px rgba(0, 0, 0, 0.4);}.preview-item-tag-name {  max-width: 60px;  overflow: hidden;  white-space: nowrap;  text-overflow: ellipsis;  word-break: break-all;}</style>