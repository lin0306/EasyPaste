<script setup lang="ts">import {onCopy, onCopyFile, onTop, onUnTop, removeItem} from "../composables/ClipboardDataComposable.ts";import {openPreviewWindow} from "../../../utils/WindowUtil.ts";import {isFolderCache} from "../composables/FileDataComposable.ts";import {useLanguage} from "../../../services/LanguageService.ts";import {useMessage} from "naive-ui";import {onMounted, onUnmounted, ref} from "vue";// 获取语言上下文const {currentLanguage} = useLanguage();// Naive UI 框架的消息组件const message = useMessage();/** * 右键菜单信息 */const props = defineProps<{  menuType: string,  item: ClipboardItem,  filePath: string,  index: number,}>();defineExpose({handleMenuShow});const isShow = ref(false);const menuX = ref(0);const menuY = ref(0);/** * 父组件调用子组件的显示右键菜单 */function handleMenuShow() {  // 先隐藏右键菜单，再修改数据  isShow.value = false;  // 计算菜单位置  calculateMenuPosition(event);  // 最后显示右键菜单  isShow.value = true;}/** * 计算菜单位置 * @param event 事件对象 */const calculateMenuPosition = (event: any) => {  const menuWidth = 90; // 菜单宽度  const menuHeight = props.menuType === 'file' ? 150 : 120; // 菜单高度估算值  // 获取视口尺寸  const viewportWidth = window.innerWidth;  const viewportHeight = window.innerHeight;  // 计算菜单位置  let x = event.pageX;  let y = event.pageY;  // 水平方向边缘检测  if (x + menuWidth > viewportWidth) {    x = viewportWidth - menuWidth - 10;  }  // 垂直方向边缘检测  if (y + menuHeight > viewportHeight) {    y = viewportHeight - menuHeight - 10;  }  menuX.value = x;  menuY.value = y;};/** * 隐藏右键菜单 */function hideContextMenu() {  isShow.value = false;}/** * 点击页面其他区域关闭菜单 * @param event 事件对象 */const handleClickOutside = (event: any) => {  if (isShow.value && !event.target.closest('.context-menu')) {    hideContextMenu();  }};/** * 右键菜单点击外部区域关闭菜单 * @param event 事件对象 */const handleContextMenuOutside = (event: any) => {  if (isShow.value && !event.target.closest('.clipboard-item')) {    hideContextMenu();  }};// 监听点击事件onMounted(() => {  // 鼠标滚轮事件  document.addEventListener('wheel', hideContextMenu);  // 点击事件  document.addEventListener('click', handleClickOutside);  // 右键菜单点击事件  document.addEventListener('contextmenu', handleContextMenuOutside);});onUnmounted(() => {  document.removeEventListener('wheel', hideContextMenu);  document.removeEventListener('click', handleClickOutside);  document.removeEventListener('contextmenu', handleContextMenuOutside);});</script><template>  <div      v-if="isShow"      class="context-menu"      :style="{ top: menuY + 'px', left: menuX + 'px' }"      @click="hideContextMenu"  >    <div class="context-menu-item" @click="onCopy(props.item, message, currentLanguage)">      <span>复制整个内容</span>    </div>    <div class="context-menu-item" v-if="props.item && !props.item.is_topped"         @click="onTop(props.item.id, props.index)">      <span>置顶</span>    </div>    <div class="context-menu-item" v-if="props.item && props.item.is_topped"         @click="onUnTop(props.item.id, props.index)">      <span>取消置顶</span>    </div>    <!-- 单击单个文件 -->    <template v-if="props.menuType === 'file'">      <div class="context-menu-divider"></div>      <div class="context-menu-item"           @click="openPreviewWindow(props.filePath, isFolderCache.get(props.filePath) || false)">        <span>文件预览</span>      </div>      <div class="context-menu-item"           @click="onCopyFile(props.item.id, props.filePath, message, currentLanguage)">        <span>复制所选文件</span>      </div>      <!--      <div class="context-menu-item">-->      <!--        <span>识别图片内容</span>-->      <!--      </div>-->    </template>    <!-- 单击文本内容 -->    <!--    <template v-if="props.menuType === 'text'">-->    <!--      <div class="context-menu-divider"></div>-->    <!--      <div class="context-menu-item">-->    <!--        <span>修改内容</span>-->    <!--      </div>-->    <!--    </template>-->    <div class="context-menu-divider"></div>    <div class="context-menu-item"         @click="removeItem(props.item, props.index, currentLanguage, message)">      <span>删除</span>    </div>  </div></template><style scoped>.context-menu {  position: fixed;  background-color: var(--theme-universal-secondary);  box-shadow: 0 0px 16px rgba(0, 0, 0, .1);  padding: 5px 0;  border-radius: 4px;  z-index: 1000;  min-width: 90px;  animation: fadeIn 0.15s ease-out;  font-size: 12px;}.context-menu-item {  cursor: pointer;  transition: background 0.2s;  display: flex;  align-items: center;  padding: 0;}.context-menu-item:hover {  background-color: var(--theme-menu-itemHover);}.context-menu-item span {  display: block;  padding: 4px 10px;  color: var(--theme-universal-text);  text-decoration: none;  transition: background-color var(--animation-duration, 0.3s);}.context-menu-divider {  height: 1px;  background-color: var(--theme-universal-border);}</style>