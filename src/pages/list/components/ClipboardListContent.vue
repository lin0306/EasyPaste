<template>  <div      class="clipboard-container"      key="clipboard-container"      :class="{'clipboard-container-search': searchBoxState.visible}"  >    <n-infinite-scroll        v-if="clipboardItems && clipboardItems.length > 0"        :distance="9"        @load="loadMoreItems"    >      <!-- 内容列表 -->      <transition-group name="item" :css="animationEffect.enabled">        <ClipboardItem            v-for="(item, index) in clipboardItems"            :key="item.id"            :item="item"            :index="index"            @custom-event="handleChildContextMenu"        />      </transition-group>      <!-- 最底部内容展示 -->      <div v-if="scrollState.isLoading" class="loading-indicator">        <n-spin :description="currentLanguage.pages.list.dataLoading"/>      </div>      <div v-if="!scrollState.hasMore" class="no-more-indicator">        {{ currentLanguage.pages.list.allLoaded }}      </div>    </n-infinite-scroll>    <!-- 无数据展示 -->    <n-empty v-else :description="currentLanguage.pages.list.empty" class="empty"/>  </div>  <!-- 右键菜单 -->  <div      v-if="contextMenuState.showMenu"      class="context-menu"      :style="{ top: contextMenuState.menuY + 'px', left: contextMenuState.menuX + 'px' }"      @click="contextMenuState.showMenu = false"  >    <div class="context-menu-item" @click="onCopy(contextMenuState.item, message, currentLanguage)">      <span>复制整个内容</span>    </div>    <div class="context-menu-item" v-if="contextMenuState.item && !contextMenuState.item.is_topped"         @click="onTop(contextMenuState.item.id, contextMenuState.index)">      <span>置顶</span>    </div>    <div class="context-menu-item" v-if="contextMenuState.item && contextMenuState.item.is_topped"         @click="onUnTop(contextMenuState.item.id, contextMenuState.index)">      <span>取消置顶</span>    </div>    <!-- 单击单个文件 -->    <template v-if="contextMenuState.menuType === 'file'">      <div class="context-menu-divider"></div>      <div class="context-menu-item" @click="openPreviewWindow(contextMenuState.filePath, isFolderCache.get(contextMenuState.filePath) || false)">        <span>文件预览</span>      </div>      <div class="context-menu-item" @click="onCopyFile(contextMenuState.item.id, contextMenuState.filePath, message, currentLanguage)">        <span>复制所选文件</span>      </div><!--      <div class="context-menu-item">--><!--        <span>识别图片内容</span>--><!--      </div>-->    </template>    <!-- 单击文本内容 --><!--    <template v-if="contextMenuState.menuType === 'text'">--><!--      <div class="context-menu-divider"></div>--><!--      <div class="context-menu-item">--><!--        <span>修改内容</span>--><!--      </div>--><!--    </template>-->    <div class="context-menu-divider"></div>    <div class="context-menu-item" @click="removeItem(contextMenuState.item, contextMenuState.index, currentLanguage, message)">      <span>删除</span>    </div>  </div></template><script setup lang="ts">import {NEmpty, NInfiniteScroll, NSpin, useMessage} from 'naive-ui';import ClipboardItem from './ClipboardItem.vue';import {useLanguage} from "../../../services/LanguageService.ts";import {  clipboardItems,  loadMoreItems,  onCopy,  onCopyFile,  onTop,  onUnTop,  removeItem,  scrollState,  searchBoxState} from "../composables/ClipboardDataComposable.ts";import {animationEffect} from "../../../components/composables/AnimationComposable.ts";import {onMounted, onUnmounted, reactive} from "vue";import {openPreviewWindow} from "../../../utils/WindowUtil.ts";import {isFolderCache} from "../composables/FileDataComposable.ts";// 获取语言上下文const {currentLanguage} = useLanguage();// Naive UI 框架的消息组件const message = useMessage();/** * 右键菜单信息 */const contextMenuState = reactive({  showMenu: false,  menuX: 0,  menuY: 0,  menuType: '',  item: {} as ClipboardItem,  filePath: '',  index: 0,});/** * 子组件调用的父组件方法 * @param data */function handleChildContextMenu(data: any) {  // 这个方法会被子组件“间接调用”  console.log('子组件传来的数据:', data)  // 先隐藏右键菜单，再修改数据  contextMenuState.showMenu = false;  contextMenuState.menuType = data.type;  contextMenuState.item = data.item;  contextMenuState.filePath = data.filePath;  contextMenuState.index = data.index;  // 计算菜单位置  calculateMenuPosition(event);  // 最后显示右键菜单  contextMenuState.showMenu = true;}/** * 计算菜单位置 * @param event 事件对象 */const calculateMenuPosition = (event: any) => {  const menuWidth = 90; // 菜单宽度  const menuHeight = contextMenuState.menuType === 'file' ? 150 : 120; // 菜单高度估算值  // 获取视口尺寸  const viewportWidth = window.innerWidth;  const viewportHeight = window.innerHeight;  // 计算菜单位置  let x = event.pageX;  let y = event.pageY;  // 水平方向边缘检测  if (x + menuWidth > viewportWidth) {    x = viewportWidth - menuWidth - 10;  }  // 垂直方向边缘检测  if (y + menuHeight > viewportHeight) {    y = viewportHeight - menuHeight - 10;  }  contextMenuState.menuX = x;  contextMenuState.menuY = y;};/** * 隐藏右键菜单 */function hideContextMenu() {  contextMenuState.showMenu = false;}/** * 点击页面其他区域关闭菜单 * @param event 事件对象 */const handleClickOutside = (event: any) => {  if (contextMenuState.showMenu && !event.target.closest('.context-menu')) {    hideContextMenu();  }};/** * 右键菜单点击外部区域关闭菜单 * @param event 事件对象 */const handleContextMenuOutside = (event: any) => {  if (contextMenuState.showMenu && !event.target.closest('.clipboard-container')) {    hideContextMenu();  }};// 监听点击事件onMounted(() => {  // 鼠标滚轮事件  document.addEventListener('wheel', hideContextMenu);  // 点击事件  document.addEventListener('click', handleClickOutside);  // 右键菜单点击事件  document.addEventListener('contextmenu', handleContextMenuOutside);});onUnmounted(() => {  document.removeEventListener('wheel', hideContextMenu);  document.removeEventListener('click', handleClickOutside);  document.removeEventListener('contextmenu', handleContextMenuOutside);});</script><style scoped>.loading-indicator {  display: flex;  justify-content: center;  align-items: center;  height: 80px;}.no-more-indicator {  display: flex;  justify-content: center;  align-items: center;  height: 50px;}.empty {  display: flex;  justify-content: center;  align-items: center;  height: 100%;}.clipboard-container {  height: calc(100vh - 80px);  /* 减去TitleBar(25px)和NavBar(30px)的高度 */  z-index: 1;  position: relative;  overflow-y: auto;  will-change: height;  transition: height var(--animation-duration, 0.3s) ease, transform var(--animation-duration, 0.3s) ease;}.clipboard-container.clipboard-container-search {  height: calc(100vh - 155px);  transform: translateY(75px);  /* 减去TitleBar(25px)和NavBar(30px)的高度 */}/** * 代码块行号样式 */:deep(.n-code__line-numbers) {  color: var(--theme-universal-textHint);}/*内容列表动画效果start*//* 进入动画 - 从右侧进入 */.item-enter-from {  opacity: 0;  transform: translateX(100%);}.item-enter-to {  opacity: 1;  transform: translateX(0);}/* 离开动画 - 向左侧离开 */.item-leave-from {  opacity: 1;  transform: translateX(0);}.item-leave-to {  opacity: 0;  transform: translateX(-100%);}/* 离开中 */.item-leave-active {  position: absolute;  width: calc(100% - 12px); /* 考虑左右 margin */}/*内容列表动画效果end*/.context-menu {  position: fixed;  background-color: var(--theme-universal-secondary);  box-shadow: 0 0px 16px rgba(0, 0, 0, .1);  padding: 5px 0;  border-radius: 4px;  z-index: 1000;  min-width: 90px;  animation: fadeIn 0.15s ease-out;  font-size: 12px;}.context-menu-item {  cursor: pointer;  transition: background 0.2s;  display: flex;  align-items: center;  padding: 0;}.context-menu-item:hover {  background-color: var(--theme-menu-itemHover);}.context-menu-item span {  display: block;  padding: 4px 10px;  color: var(--theme-universal-text);  text-decoration: none;  transition: background-color var(--animation-duration, 0.3s);}.context-menu-divider {  height: 1px;  background-color: var(--theme-universal-border);}</style>