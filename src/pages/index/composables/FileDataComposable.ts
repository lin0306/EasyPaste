import {isImage, readImageAsBase64} from "../../../utils/FileUtil.ts";import {error} from "@tauri-apps/plugin-log";import {exists, readDir} from "@tauri-apps/plugin-fs";import {ref} from "vue";/** * 图片缓存，用于存储图片的base64数据 */export const imageDataCache = ref(new Map<string, string>());/** * 文件是否存在缓存，用于存储文件是否存在状态 */export const fileExistCache = ref(new Map<string, boolean>());/** * 判断文件是否为文件夹，用于存储文件是否为文件夹状态 */export const isFolderCache = ref(new Map<string, boolean>());/** * 检查文件是否存在 * @param filePaths 文件路径列表 */export function checkFileExist(filePaths: string) {    if (!filePaths) {        return;    }    const filePathList: Array<string> = JSON.parse(filePaths);    if (filePathList.length === 1) {        const filePath: string = filePathList[0];        // 处理图片类型的文件        if (isImage(filePath)) {            // 这里不需要等待结果，避免处理慢            loadImageFromPath(filePath);        }        loadFileExist(filePath);        loadFileIsFolder(filePath);    } else {        filePathList.forEach(filePath => {            // 处理图片类型的文件            if (isImage(filePath)) {                loadImageFromPath(filePath);            }            loadFileExist(filePath);            loadFileIsFolder(filePath);        });    }}/** * 从文件系统加载图片 * @param filePath 文件路径 */async function loadImageFromPath(filePath: string | null) {    if (!filePath) {        return;    }    if (imageDataCache.value.get(filePath)) {        return;    }    try {        const base64Image = await readImageAsBase64(filePath);        if (base64Image) {            imageDataCache.value.set(filePath, base64Image);        }    } catch (err) {        error('加载图片失败:' + err);        throw err;    }}/** * 加载文件是否存在 * @param filePath 文件路径 */async function loadFileExist(filePath: string) {    if (!filePath) {        return;    }    try {        fileExistCache.value.set(filePath, await exists(filePath));    } catch (e) {        console.error('检查文件是否存在失败:', e);    }}/** * 加载文件夹是否存在 * @param filePath 文件路径 */async function loadFileIsFolder(filePath: string) {    if (!filePath) {        return;    }    try {        isFolderCache.value.set(filePath, await readDir(filePath) !== null);        console.log('文件夹是否存在:', isFolderCache.value.get(filePath))    } catch (e) {        console.error('检查文件是否存在失败:', e);    }}/** * 定时检查文件是否存在 */let fileExistTimer: any = null;function initFileExistTimer() {    return setInterval(async () => {        fileExistCache.value.forEach((_value, key) => {            loadFileExist(key);        })    }, 1000 * 60); // 时间可调整}/** * 初始化文件数据配置 */export function initializeFileData() {    // 初始化文件是否存在定时任务    fileExistTimer = initFileExistTimer();}/** * 销毁文件数据配置 */export function destroyFileData() {    // 清除文件是否存在定时任务    if (fileExistTimer) {        clearInterval(fileExistTimer);    }}