<script setup lang="ts">import {h, onMounted, ref} from "vue";import {filePathConvertFileName} from "../../../utils/strUtil.ts";import {NGradientText, TreeOption} from "naive-ui";import {readDir} from "@tauri-apps/plugin-fs";import {isMac} from "../../../data/SystemParams.ts";import FolderIcon from "../icons/FolderIcon.vue";import OpenFolderIcon from "../icons/OpenFolderIcon.vue";const props = defineProps<{  filePath: string}>()const folderTree = ref<TreeOption[]>();/** * 异步加载子节点数据 * @param node */async function handleLoad(node: TreeOption) {  const entries = await readDir(String(node.key));  const tree = [];  node.count = entries.length;  node.suffix = () => h(NGradientText, {type: 'success'}, {default: () => entries.length})  for (let i = 0; i < entries.length; i++) {    const entry = entries[i];    const key = node.key + (isMac ? "/" : "\\") + entry.name;    if (entry.isDirectory) {      tree[i] = {        key: key,        label: entry.name,        isLeaf: false,        prefix: () => h(FolderIcon, null, {default: () => h(FolderIcon)}),      }    } else {      tree[i] = {        key: key,        label: entry.name,        isLeaf: true,      }    }  }  node.children = tree;  countChildren(folderTree.value[0]);}function countChildren(option: TreeOption) {  if (option.children && option.children.length > 0) {    for (let c of option.children) {      countChildren(c);    }    let count = 0;    if (!option.children) {      count = 1;    } else if (option.children && option.children.length > 0) {      for (let c of option.children) {        count += c.count;      }    }    option.count = count + 1;    if (option.children) {      option.suffix = () => h(NGradientText, {type: 'success'}, {        default: () => {          return count + "个文件"        }      })    }  } else {    option.count = 1;  }}/** * 修改展开收起时的前缀图标 */function updatePrefixWithExpanded(    _keys: Array<string | number>,    _option: Array<TreeOption | null>,    meta: {      node: TreeOption | null      action: 'expand' | 'collapse' | 'filter'    }) {  if (!meta.node)    return  switch (meta.action) {    case 'expand':      meta.node.prefix = () =>          h(OpenFolderIcon, null, {            default: () => h(OpenFolderIcon)          })      break    case 'collapse':      meta.node.prefix = () =>          h(FolderIcon, null, {            default: () => h(FolderIcon)          })      break  }}onMounted(() => {  const folderPath = filePathConvertFileName(props.filePath);  folderTree.value = [{    key: props.filePath,    label: folderPath,    isLeaf: false,    prefix: () => h(FolderIcon, null, {default: () => h(FolderIcon)}),  }];})</script><template>  <div class="folder-container">    <n-tree        :data="folderTree"        :on-load="handleLoad"        :on-update:expanded-keys="updatePrefixWithExpanded"        expand-on-click        show-line        cascade        block-line    />  </div></template><style scoped>.folder-container {  width: 100%;  height: 100%;  overflow-y: auto;}</style>