<script setup lang="ts">import {h, onMounted, ref} from "vue";import {filePathConvertFileName} from "../../../utils/TextUtil.ts";import {NGradientText, TreeOption} from "naive-ui";import {readDir} from "@tauri-apps/plugin-fs";import {isMac} from "../../../data/SystemParams.ts";import {updatePrefixWithExpanded} from "../../../utils/TreeUtil.ts";import CloseFolderIcon from "../../../assets/icons/CloseFolderIcon.vue";import {useTheme} from "../../../services/ThemeService.ts";import {currentLanguage} from "../../../services/LanguageService.ts";const {themeColors} = useTheme();const props = defineProps<{  filePath: string}>()const folderTree = ref<TreeOption[]>();/** * 异步加载子节点数据 * @param node */async function handleLoad(node: TreeOption) {  const entries = await readDir(String(node.key));  const tree = [];  node.count = entries.length;  node.suffix = () => h(NGradientText, {    type: 'info',    gradient: {deg: 180, from: themeColors.value.universal.textHint, to: themeColors.value.universal.textHint}  }, {default: () => entries.length})  for (let i = 0; i < entries.length; i++) {    const entry = entries[i];    const key = node.key + (isMac ? "/" : "\\") + entry.name;    if (entry.isDirectory) {      tree[i] = {        key: key,        label: entry.name,        isLeaf: false,        prefix: () => h(CloseFolderIcon, null, {default: () => h(CloseFolderIcon)}),      }    } else {      tree[i] = {        key: key,        label: entry.name,        isLeaf: true,      }    }  }  node.children = tree;  if (folderTree.value) {    countChildren(folderTree.value[0]);  }}/** * 统计子节点数量 * @param option 节点 */function countChildren(option: TreeOption) {  if (option.children && option.children.length > 0) {    for (let c of option.children) {      countChildren(c);    }    let count = 0;    if (!option.children) {      count = 1;    } else if (option.children && option.children.length > 0) {      for (let c of option.children) {        // @ts-ignore        count += c.count;      }    }    option.count = count + 1;    if (option.children) {      option.suffix = () => h(NGradientText, {            type: 'info',            gradient: {deg: 180, from: themeColors.value.universal.textHint, to: themeColors.value.universal.textHint}          },          {            default:                () => {                  return count + currentLanguage.value.pages.preview.fileCount                }          }      )    }  } else {    option.count = 1;  }}onMounted(() => {  const folderPath = filePathConvertFileName(props.filePath);  folderTree.value = [{    key: props.filePath,    label: folderPath,    isLeaf: false,    prefix: () => h(CloseFolderIcon, null, {default: () => h(CloseFolderIcon)}),  }];})</script><template>  <div class="folder-container">    <n-tree        :data="folderTree"        :on-load="handleLoad"        :on-update:expanded-keys="updatePrefixWithExpanded"        expand-on-click        show-line        cascade        block-line    />  </div></template><style scoped>.folder-container {  width: 100%;  height: 100%;  overflow-y: auto;}</style>