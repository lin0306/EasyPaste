<script setup lang="ts">import HintIcon from "../../../assets/icons/HintIcon.vue";import {currentConfig, onLoading, originalConfig, selectedKey} from "../composables/settingsComposable.ts";import {useMessage} from "naive-ui";import {useLanguage} from "../../../services/LanguageService.ts";import {  getDataRetentionDays,  getMaxHistoryItems,  saveDataRetentionDays,  saveMaxHistoryItems} from "../../../store/Settings.ts";import {emit} from "@tauri-apps/api/event";import {error} from "@tauri-apps/plugin-log";import {onMounted} from "vue";const message = useMessage();const {currentLanguage} = useLanguage();/** * 修改最大历史记录项数 */async function onChangeMaxHistoryItems() {  if (currentConfig.maxHistoryItems !== originalConfig.maxHistoryItems) {    onLoading.value = true;    try {      await saveMaxHistoryItems(currentConfig.maxHistoryItems);      await emit('update-data-history-restrict', {        maxHistoryItems: currentConfig.maxHistoryItems,        dataRetentionDays: currentConfig.dataRetentionDays      });      originalConfig.maxHistoryItems = currentConfig.maxHistoryItems;    } catch (e) {      error('修改最大历史记录项数设置出错:' + e);      message.error(currentLanguage.value.pages.settings.saveFailedMsg);      currentConfig.maxHistoryItems = originalConfig.maxHistoryItems;    } finally {      onLoading.value = false;    }  }}/** * 修改数据保留天数 */async function onChangeDataRetentionDays() {  if (currentConfig.dataRetentionDays !== originalConfig.dataRetentionDays) {    onLoading.value = true;    try {      await saveDataRetentionDays(currentConfig.dataRetentionDays);      await emit('update-data-history-restrict', {        maxHistoryItems: currentConfig.maxHistoryItems,        dataRetentionDays: currentConfig.dataRetentionDays      });      originalConfig.dataRetentionDays = currentConfig.dataRetentionDays;    } catch (e) {      error('修改数据保留天数设置出错:' + e);      message.error(currentLanguage.value.pages.settings.saveFailedMsg);      currentConfig.dataRetentionDays = originalConfig.dataRetentionDays;    } finally {      onLoading.value = false;    }  }}// 加载配置onMounted(async () => {  try {    // 初始化用户配置    const maxHistoryItems = await getMaxHistoryItems();    originalConfig.maxHistoryItems = maxHistoryItems;    currentConfig.maxHistoryItems = maxHistoryItems;    const dataRetentionDays = await getDataRetentionDays();    originalConfig.dataRetentionDays = dataRetentionDays;    currentConfig.dataRetentionDays = dataRetentionDays;  } catch (e) {    console.error('页面初始化失败:', e);    error("页面初始化失败：" + e);    message.error(currentLanguage.value.pages.settings.initFailedHint);  }});</script><template>  <!-- 存储设置 -->  <div v-if="selectedKey === 'storage'" :key="'storage'" class="settings-section">    <h2>{{ currentLanguage.pages.settings.storageTitle }}</h2>    <div class="line">      <div class="main-item">        <span class="label">{{ currentLanguage.pages.settings.maxHistoryItems }}</span>        <n-input-number            class="input-number"            v-model:value="currentConfig.maxHistoryItems"            :min="0"            :max="10000"            :loading="onLoading"            :disabled="onLoading"            @blur="onChangeMaxHistoryItems"        />      </div>      <div class="second-item">        <div class="hint">          <HintIcon class="hint-icon"/>          {{ currentLanguage.pages.settings.maxHistoryItemsHint }}        </div>      </div>    </div>    <div class="line">      <div class="main-item">        <span class="label">{{ currentLanguage.pages.settings.dataRetentionDays }}</span>        <n-input-number            class="input-number"            v-model:value="currentConfig.dataRetentionDays"            :min="0"            :max="365"            :loading="onLoading"            :disabled="onLoading"            @blur="onChangeDataRetentionDays"        />      </div>      <div class="second-item">        <div class="hint">          <HintIcon class="hint-icon"/>          {{ currentLanguage.pages.settings.dataRetentionDaysHint }}        </div>      </div>    </div>  </div></template><style scoped></style>