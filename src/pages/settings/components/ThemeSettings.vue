<script setup lang="ts">import HintIcon from "../../../assets/icons/HintIcon.vue";import {currentConfig, onLoading, originalConfig} from "../composables/SettingsDataComposable.ts";import {useMessage} from "naive-ui";import {useLanguage} from "../../../services/LanguageService.ts";import {computed, onMounted} from "vue";import {  getAnimationSpeedLevel,  getEnableAnimationEffects,  saveAnimationDuration,  saveAnimationSpeedLevel,  saveEnableAnimationEffects} from "../../../store/Settings.ts";import {emit} from "@tauri-apps/api/event";import {error} from "@tauri-apps/plugin-log";import {getSpeedDuration, SETTINGS} from "../../../constants/UserSettingsConstant.ts";import {themes, useTheme} from "../../../services/ThemeService.ts";const message = useMessage();const {currentLanguage} = useLanguage();const {currentThemeId, toggleTheme} = useTheme();// 动画速度选项const animationSpeedOptions = computed(() => [  {    label: currentLanguage.value.pages.settings.transitionSpeedFast,    value: SETTINGS.THEME.ANIMATION.SPEED.FAST.key,  },  {    label: currentLanguage.value.pages.settings.transitionSpeedNormal,    value: SETTINGS.THEME.ANIMATION.SPEED.NORMAL.key,  },  {    label: currentLanguage.value.pages.settings.transitionSpeedSlow,    value: SETTINGS.THEME.ANIMATION.SPEED.SLOW.key,  },]);/** * 修改是否启用动画效果 * @param enableAnimationEffects 是否启用动画效果 */async function onChangeEnableAnimationEffects(enableAnimationEffects: boolean) {  onLoading.value = true;  try {    await saveEnableAnimationEffects(enableAnimationEffects);    // 停用动画效果，动画持续时间置0    if (!enableAnimationEffects) {      await saveAnimationDuration(0);    }    // todo 发送全局消息    await emit('update-animation-effect', {      isEnable: enableAnimationEffects,      duration: currentConfig.animationDuration,    });    originalConfig.enableAnimationEffects = enableAnimationEffects;    currentConfig.enableAnimationEffects = enableAnimationEffects;    if (!enableAnimationEffects) {      currentConfig.animationDuration = 0;      originalConfig.animationDuration = 0;    }  } catch (e) {    error('修改是否启用动画效果设置出错:' + e);    message.error(currentLanguage.value.pages.settings.saveFailedMsg);    currentConfig.enableAnimationEffects = originalConfig.enableAnimationEffects;  } finally {    // 设置动画持续时长    document.documentElement.style.setProperty('--animation-duration', currentConfig.animationDuration + 'ms');    onLoading.value = false;  }}/** * 修改动画速度级别 * @param animationSpeedLevel 动画速度级别 */async function onChangeAnimationSpeedLevel(animationSpeedLevel: string) {  if (animationSpeedLevel === originalConfig.animationSpeedLevel) {    return;  }  onLoading.value = true;  try {    const duration = getSpeedDuration(animationSpeedLevel);    await saveAnimationDuration(duration);    await saveAnimationSpeedLevel(animationSpeedLevel);    // todo 发送全局消息    await emit('update-animation-effect', {      isEnable: currentConfig.enableAnimationEffects,      duration: duration,    });    originalConfig.animationSpeedLevel = animationSpeedLevel;    currentConfig.animationSpeedLevel = animationSpeedLevel;  } catch (e) {    error('修改动画速度级别设置出错:' + e);    message.error(currentLanguage.value.pages.settings.saveFailedMsg);    currentConfig.animationSpeedLevel = originalConfig.animationSpeedLevel;  } finally {    onLoading.value = false;  }}// 加载配置onMounted(async () => {  try {    // 初始化用户配置    const enableAnimationEffects = await getEnableAnimationEffects();    originalConfig.enableAnimationEffects = enableAnimationEffects;    currentConfig.enableAnimationEffects = enableAnimationEffects;    const animationSpeedLevel = await getAnimationSpeedLevel();    originalConfig.animationSpeedLevel = animationSpeedLevel;    currentConfig.animationSpeedLevel = animationSpeedLevel;  } catch (e) {    console.error('页面初始化失败:', e);    error("页面初始化失败：" + e);    message.error(currentLanguage.value.pages.settings.initFailedHint);  }});</script><template>  <!-- 主题设置 -->  <div class="settings-section">    <h2>{{ currentLanguage.pages.settings.themesTitle }}</h2>    <div class="themes-line">      <div v-for="theme in themes"           class="theme-block"           :style="{              backgroundColor: theme.colors.background,              border: theme.id === currentThemeId ? ('2px solid ' + theme.colors.secondary) : ''           }"           :class="{'theme-selected': theme.id === currentThemeId}"           @click="toggleTheme(theme.id)"      >        <div class="theme-title" :style="{backgroundColor: theme.colors.titleBarBackground}"></div>        <div class="theme-content">          <div class="theme-content-line" :style="{backgroundColor: theme.colors.cardBackground}">            <div :style="{color: theme.colors.text}" class="theme-name">{{ currentLanguage.pages.list.menu[theme.id] }}</div>          </div>          <div class="theme-content-line" :style="{backgroundColor: theme.colors.cardBackground}"></div>        </div>      </div>    </div>    <h2>{{ currentLanguage.pages.settings.animationTitle }}</h2>    <!-- 动画配置选项 -->    <div class="form-item">      <span class="label">{{ currentLanguage.pages.settings.enableAnimationEffects }}</span>      <div class="switch-with-status">        <n-switch            v-model:value="currentConfig.enableAnimationEffects"            :loading="onLoading"            @update:value="onChangeEnableAnimationEffects"        />      </div>    </div>    <!-- 配置动画速度 -->    <div class="form-item" v-if="currentConfig.enableAnimationEffects">      <span class="label">{{ currentLanguage.pages.settings.transitionSpeed }}</span>      <n-select          class="select"          v-model:value="currentConfig.animationSpeedLevel"          :loading="onLoading"          :options="animationSpeedOptions"          @update:value="onChangeAnimationSpeedLevel"      />    </div>    <!-- 动画配置提示 -->    <div class="line" v-if="currentConfig.enableAnimationEffects">      <div class="second-item">        <div class="hint">          <HintIcon class="hint-icon"/>          <span class="hint-text">                  {{ currentLanguage.pages.settings.animationHint }}                </span>        </div>      </div>    </div>  </div></template><style scoped>.themes-line {  display: flex;  gap: 13px;  margin: 0 5px;  align-items: center;}.theme-block {  width: 70px;  height: 70px;  border-radius: 6px;  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);}.theme-title {  width: 100%;  height: 10px;}.theme-name {  font-size: 12px;  text-align: center;}.theme-content {  height: 50px;  display: flex;  margin: 5px;  flex-direction: column;  justify-content: space-around;}.theme-content-line {  width: 95%;  padding: 5px 0;  border-radius: 4px;  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);}.theme-selected {  transform: scale(1.05);}</style>