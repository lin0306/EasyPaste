<script setup lang="ts">import HintIcon from "../../../assets/icons/HintIcon.vue";import {currentConfig, onLoading, originalConfig} from "../composables/settingsComposable.ts";import {useMessage} from "naive-ui";import {useLanguage} from "../../../services/LanguageService.ts";import {computed, onMounted} from "vue";import {  getAnimationSpeedLevel,  getEnableAnimationEffects,  saveAnimationSpeedLevel,  saveEnableAnimationEffects} from "../../../store/Settings.ts";import {emit} from "@tauri-apps/api/event";import {error} from "@tauri-apps/plugin-log";const message = useMessage();const {currentLanguage} = useLanguage();// 动画速度选项const transitionSpeedOptions = computed(() => [  {    label: currentLanguage.value.pages.settings.transitionSpeedFast,    value: 'fast',  },  {    label: currentLanguage.value.pages.settings.transitionSpeedNormal,    value: 'normal',  },  {    label: currentLanguage.value.pages.settings.transitionSpeedSlow,    value: 'slow',  },]);/** * 修改是否启用动画效果 * @param enableAnimationEffects 是否启用动画效果 */async function onChangeEnableAnimationEffects(enableAnimationEffects: boolean) {  onLoading.value = true;  try {    await saveEnableAnimationEffects(enableAnimationEffects);    // todo 发送全局消息    await emit('', {      isEnable: currentConfig.enableAnimationEffects,      speed: currentConfig.animationSpeedLevel,    });    originalConfig.enableAnimationEffects = enableAnimationEffects;    currentConfig.enableAnimationEffects = enableAnimationEffects;  } catch (e) {    error('修改是否启用动画效果设置出错:' + e);    message.error(currentLanguage.value.pages.settings.saveFailedMsg);    currentConfig.enableAnimationEffects = originalConfig.enableAnimationEffects;  } finally {    onLoading.value = false;  }}/** * 修改动画速度级别 * @param animationSpeedLevel 动画速度级别 */async function onChangeAnimationSpeedLevel(animationSpeedLevel: string) {  onLoading.value = true;  try {    await saveAnimationSpeedLevel(animationSpeedLevel);    // todo 发送全局消息    await emit('', {      isEnable: currentConfig.enableAnimationEffects,      speed: currentConfig.animationSpeedLevel,    });    originalConfig.animationSpeedLevel = animationSpeedLevel;    currentConfig.animationSpeedLevel = animationSpeedLevel;  } catch (e) {    error('修改动画速度级别设置出错:' + e);    message.error(currentLanguage.value.pages.settings.saveFailedMsg);    currentConfig.animationSpeedLevel = originalConfig.animationSpeedLevel;  } finally {    onLoading.value = false;  }}// 加载配置onMounted(async () => {  try {    // 初始化用户配置    const enableAnimationEffects = await getEnableAnimationEffects();    originalConfig.enableAnimationEffects = enableAnimationEffects;    currentConfig.enableAnimationEffects = enableAnimationEffects;    const animationSpeedLevel = await getAnimationSpeedLevel();    originalConfig.animationSpeedLevel = animationSpeedLevel;    currentConfig.animationSpeedLevel = animationSpeedLevel;  } catch (e) {    console.error('页面初始化失败:', e);    error("页面初始化失败：" + e);    message.error(currentLanguage.value.pages.settings.initFailedHint);  }});</script><template>  <!-- 主题设置 -->  <div :key="'themes'" class="settings-section">    <h2>{{ currentLanguage.pages.settings.themesTitle }}</h2>    <!-- 动画配置选项 -->    <div class="form-item">      <span class="label">{{ currentLanguage.pages.settings.enableAnimationEffects }}</span>      <div class="switch-with-status">        <n-switch            v-model:value="currentConfig.enableAnimationEffects"            :loading="onLoading"            @update:value="onChangeEnableAnimationEffects"        />      </div>    </div>    <!-- 配置动画速度 -->    <div class="form-item" v-if="currentConfig.enableAnimationEffects">      <span class="label">{{ currentLanguage.pages.settings.transitionSpeed }}</span>      <n-select          class="select"          v-model:value="currentConfig.animationSpeedLevel"          :loading="onLoading"          :options="transitionSpeedOptions"          @update:value="onChangeAnimationSpeedLevel"      />    </div>    <!-- 动画配置提示 -->    <div class="line" v-if="currentConfig.enableAnimationEffects">      <div class="second-item">        <div class="hint">          <HintIcon class="hint-icon"/>          <span class="hint-text">                  {{ currentLanguage.pages.settings.animationHint }}                </span>        </div>      </div>    </div>  </div></template><style scoped></style>