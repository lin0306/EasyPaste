<script setup lang="ts">import {currentConfig, onLoading, originalConfig} from "../composables/SettingsDataComposable.ts";import {useLanguage} from "../../../services/LanguageService.ts";import {computed, onMounted} from "vue";import {  getBindTagBtnShowLocation,  getEnableTag,  saveBindTagBtnShowLocation,  saveEnableTag} from "../../../store/Settings.ts";import {error} from "@tauri-apps/plugin-log";import {emit} from "@tauri-apps/api/event";import {useMessage} from "naive-ui";import {SETTINGS} from "../../../constants/UserSettingsConstant.ts";const {currentLanguage} = useLanguage();const message = useMessage();// 标签绑定按钮位置const bindTagBtnShowLocation = computed(() => [{  value: SETTINGS.GENERATE.BIND_TAG_LOCATION.TOP_RIGHT,  label: currentLanguage.value.pages.settings.topRight,}, {  value: SETTINGS.GENERATE.BIND_TAG_LOCATION.BOTTOM_RIGHT,  label: currentLanguage.value.pages.settings.bottomRight,}]);/** * 修改是否启用标签 * @param enableTag 是否启用标签 */async function onChangeEnableTag(enableTag: boolean) {  onLoading.value = true;  try {    await saveEnableTag(enableTag);    // 发送更新了启用标签状态消息    await emit('update-tag-setting-state', {      isShow: currentConfig.enableTag,      location: currentConfig.bindTagBtnShowLocation,    });    originalConfig.enableTag = enableTag;    currentConfig.enableTag = enableTag;  } catch (e) {    error('修改是否启用标签设置出错:' + e);    message.error(currentLanguage.value.pages.settings.saveFailedMsg);    currentConfig.enableTag = originalConfig.enableTag;  } finally {    onLoading.value = false;  }}/** * 修改标签按钮显示位置 * @param bindTagBtnShowLocation 标签按钮显示位置 */async function onChangeBindTagBtnShowLocation(bindTagBtnShowLocation: string) {  if (bindTagBtnShowLocation === originalConfig.bindTagBtnShowLocation) {    return;  }  onLoading.value = true;  try {    await saveBindTagBtnShowLocation(bindTagBtnShowLocation);    // 发送更新了启用标签状态消息    await emit('update-tag-setting-state', {      isShow: currentConfig.enableTag,      location: currentConfig.bindTagBtnShowLocation,    });    originalConfig.bindTagBtnShowLocation = bindTagBtnShowLocation;    currentConfig.bindTagBtnShowLocation = bindTagBtnShowLocation;  } catch (e) {    error('修改标签按钮显示位置设置出错:' + e);    message.error(currentLanguage.value.pages.settings.saveFailedMsg);    currentConfig.bindTagBtnShowLocation = originalConfig.bindTagBtnShowLocation;  } finally {    onLoading.value = false;  }}// 加载配置onMounted(async () => {  try {    // 初始化用户配置    const enableTag = await getEnableTag();    originalConfig.enableTag = enableTag;    currentConfig.enableTag = enableTag;    const bindTagBtnShowLocation = await getBindTagBtnShowLocation();    originalConfig.bindTagBtnShowLocation = bindTagBtnShowLocation;    currentConfig.bindTagBtnShowLocation = bindTagBtnShowLocation;  } catch (e) {    console.error('页面初始化失败:', e);    error("页面初始化失败：" + e);    message.error(currentLanguage.value.pages.settings.initFailedHint);  }});</script><template>  <div class="settings-section">    <h2>{{ currentLanguage.pages.settings.tagTitle }}</h2>    <div class="form-item">      <span class="label">{{ currentLanguage.pages.settings.enableTag }}</span>      <n-switch v-model:value="currentConfig.enableTag"                :loading="onLoading"                :disabled="onLoading"                @update:value="onChangeEnableTag"      />    </div>    <div class="form-item" v-if="currentConfig.enableTag">      <span class="label">{{ currentLanguage.pages.settings.bindTagBtnShowLocation }}</span>      <n-select class="select"                v-model:value="currentConfig.bindTagBtnShowLocation"                :options="bindTagBtnShowLocation"                :loading="onLoading"                :disabled="onLoading"                @update:value="onChangeBindTagBtnShowLocation"      />    </div>  </div></template><style scoped></style>