import {load} from "@tauri-apps/plugin-store";import {info} from "@tauri-apps/plugin-log";import {SHORTCUT_KEYS_KEYS} from "../constants/KeysConstants.ts";import {BaseDirectory, exists, readFile} from "@tauri-apps/plugin-fs";import {utf8Decoder} from "../constants/PublicConstants.ts";export const SHORTCUT_KEYS_FILE_NAME = "shortcutKeys.json";const defaultShortcutKeys: ShortcutKeys = {    search: {        name: "搜索",        key: [            "ctrl",            "f"        ]    },    wakeUpRoutine: {        name: "唤醒程序",        key: [            "alt",            "c"        ]    }}/** * 保存搜索快捷键 * @param keys 快捷键 */export async function saveSearchKey(keys: any) {    info("保存搜索快捷键" + JSON.stringify(keys))    const settings = await load(SHORTCUT_KEYS_FILE_NAME, {autoSave: true});    await settings.set(SHORTCUT_KEYS_KEYS.SEARCH, keys);}/** * 获取搜索快捷键 */export async function getSearchKey(): Promise<ShortcutKeys['search']> {    const settings = await load(SHORTCUT_KEYS_FILE_NAME, {autoSave: true});    return await settings.get<ShortcutKeys['search']>(SHORTCUT_KEYS_KEYS.SEARCH) || defaultShortcutKeys.search;}/** * 保存唤醒程序快捷键 * @param keys 快捷键 */export async function saveWakeUpRoutineKey(keys: any) {    info("保存唤醒程序快捷键" + JSON.stringify(keys))    const settings = await load(SHORTCUT_KEYS_FILE_NAME, {autoSave: true});    await settings.set(SHORTCUT_KEYS_KEYS.WAKE_UP_ROUTINE, keys);}/** * 获取唤醒程序快捷键 */export async function getWakeUpRoutine(): Promise<ShortcutKeys['wakeUpRoutine']> {    const settings = await load(SHORTCUT_KEYS_FILE_NAME, {autoSave: true});    return await settings.get<ShortcutKeys['wakeUpRoutine']>(SHORTCUT_KEYS_KEYS.WAKE_UP_ROUTINE) || defaultShortcutKeys.wakeUpRoutine;}/** * 初始化用户快捷键配置 */export async function initShortcutKeys() {    const shortcutKeysExist = await exists(SHORTCUT_KEYS_FILE_NAME, {        baseDir: BaseDirectory.AppData,    });    if (shortcutKeysExist) {        const settings = await load(SHORTCUT_KEYS_FILE_NAME, {autoSave: true});        // 快捷键配置文件存在        const shortcutKeys = await readFile(SHORTCUT_KEYS_FILE_NAME, {            baseDir: BaseDirectory.AppData,        })        // 转成字符串        const shortcutKeysString = utf8Decoder.decode(shortcutKeys);        if (!shortcutKeysString.includes(SHORTCUT_KEYS_KEYS.SEARCH)) {            await settings.set(SHORTCUT_KEYS_KEYS.SEARCH, defaultShortcutKeys.search);        }        if (!shortcutKeysString.includes(SHORTCUT_KEYS_KEYS.WAKE_UP_ROUTINE)) {            await settings.set(SHORTCUT_KEYS_KEYS.WAKE_UP_ROUTINE, defaultShortcutKeys.wakeUpRoutine);        }        await settings.save();    } else {        // 快捷键配置文件不存在        const settings = await load(SHORTCUT_KEYS_FILE_NAME, {autoSave: true});        await settings.set(SHORTCUT_KEYS_KEYS.SEARCH, defaultShortcutKeys.search);        await settings.set(SHORTCUT_KEYS_KEYS.WAKE_UP_ROUTINE, defaultShortcutKeys.wakeUpRoutine);        await settings.save();    }}